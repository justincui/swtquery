<?xml version="1.0" encoding="UTF-8"?>
<project default="generate-all" name="Generator">
	<property name="target" location="${eclipse.home}" />

	<path id="class.path">
		<fileset dir="${target}/plugins">
			<include name="org.eclipse.swt*.jar" />
			<include name="org.eclipse.jface*.jar" />
			<include name="org.eclipse.core.runtime*.jar" />
			<include name="org.eclipse.core.jobs*.jar" />
			<include name="org.eclipse.equinox.common*.jar" />
			<include name="org.eclipse.ui.*.jar" />
		</fileset>
	</path>

	<target name="clean">
		<echo>Cleaing...</echo>
		<delete includeemptydirs="true">
			<fileset dir="${basedir}">
				<include name="gen/**/*" />
				<include name="gen" />
			</fileset>
		</delete>
		<eclipse.refreshLocal resource="/" depth="infinite" />
		<eclipse.incrementalBuild project="kr.or.eclipse.swt.query" kind="incremental" />
	</target>

	<target name="generate-all" depends="clean">
		<eclipse.refreshLocal resource="kr.or.eclipse.swt.query" depth="infinite" />

		<echo>Building step 1...</echo>
		<eclipse.incrementalBuild project="kr.or.eclipse.swt.query" kind="incremental" />

		<echo>Generating step 1...</echo>
		<antcall target="generate">
			<param name="options">basic</param>
		</antcall>

		<echo>Building step 2...</echo>
		<eclipse.incrementalBuild />

		<echo>Generating step 2...</echo>
		<antcall target="generate">
			<param name="options">advanced</param>
		</antcall>
		<eclipse.refreshLocal resource="/" depth="infinite" />
		
		<echo>Building step 3...</echo>
		<eclipse.incrementalBuild project="kr.or.eclipse.swt.query" kind="incremental" />
	</target>

	<target name="generate">
		<java classname="kr.or.eclipse.swt.query.internal.generators.GenerateAll" logerror="true" failonerror="true">
			<arg path="gen" />
			<arg value="${options}" />
			<classpath refid="class.path" />
			<classpath>
				<pathelement location="bin" />
			</classpath>
		</java>
		<eclipse.refreshLocal resource="/" depth="infinite" />
	</target>
</project>